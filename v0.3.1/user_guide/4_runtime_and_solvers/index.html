<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Runtime and solvers · XCALibre.jl</title><meta name="title" content="Runtime and solvers · XCALibre.jl"/><meta property="og:title" content="Runtime and solvers · XCALibre.jl"/><meta property="twitter:title" content="Runtime and solvers · XCALibre.jl"/><meta name="description" content="Documentation for XCALibre.jl."/><meta property="og:description" content="Documentation for XCALibre.jl."/><meta property="twitter:description" content="Documentation for XCALibre.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">XCALibre.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quick_start/">Quick Start</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/01_2d-isothermal-backward-facing-step/">Verification: 2D incompressible backward-facing step</a></li><li><a class="tocitem" href="../../examples/02_2d-incompressible-transient-cylinder/">Verification: 2D Unsteady incompressible cylinder</a></li><li><a class="tocitem" href="../../examples/03_2d-constant-temperature-flat-plate/">Validation: 2D Constant temperature flat plate</a></li><li><a class="tocitem" href="../../examples/04_2d-inflow-using-Flux/">Advanced: 2D inflow using <code>Flux.jl</code></a></li><li><a class="tocitem" href="../../examples/05_2d-aerofoil-inflow-optimisation/">Advanced: 2D Aerofoil inflow optimisation</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../0_introduction_and_workflow/">Introduction</a></li><li><a class="tocitem" href="../1_preprocessing/">Pre-processing</a></li><li><a class="tocitem" href="../2_physics_and_models/">Physics and models</a></li><li><a class="tocitem" href="../3_numerical_setup/">Numerical setup</a></li><li class="is-active"><a class="tocitem" href>Runtime and solvers</a><ul class="internal"><li><a class="tocitem" href="#Runtime-setup"><span>Runtime setup</span></a></li><li><a class="tocitem" href="#Configuration-object"><span>Configuration object</span></a></li><li><a class="tocitem" href="#Initialising-fields"><span>Initialising fields</span></a></li><li><a class="tocitem" href="#Launching-flow-solvers"><span>Launching flow solvers</span></a></li><li><a class="tocitem" href="#Restarting-simulations"><span>Restarting simulations</span></a></li></ul></li><li><a class="tocitem" href="../5_postprocessing/">Post-processing</a></li></ul></li><li><a class="tocitem" href="../../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Runtime and solvers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Runtime and solvers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mberto79/XCALibre.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mberto79/XCALibre.jl/blob/main/docs/src/user_guide/4_runtime_and_solvers.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Runtime-and-solvers"><a class="docs-heading-anchor" href="#Runtime-and-solvers">Runtime and solvers</a><a id="Runtime-and-solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Runtime-and-solvers" title="Permalink"></a></h1><p><em>Final steps before launching a simulation</em></p><h2 id="Runtime-setup"><a class="docs-heading-anchor" href="#Runtime-setup">Runtime setup</a><a id="Runtime-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Runtime-setup" title="Permalink"></a></h2><hr/><p>At this stage in the setup workflow, the user defines the runtime information to configure the runtime behaviour of the  flow solver, including the time step to use (only meaningful for transient solutions), as well as information about how often to write results to disk. XCALibre.jl provides a the <code>set_runtime</code> to perform this operation. </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="XCALibre.Solve.set_runtime-user_guide-4_runtime_and_solvers" href="#XCALibre.Solve.set_runtime-user_guide-4_runtime_and_solvers"><code>XCALibre.Solve.set_runtime</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_runtime(; 
    # keyword arguments
    iterations::I, 
    write_interval::I, 
    time_step::N
    ) where {I&lt;:Integer,N&lt;:Number} = begin
    
    # returned `NamedTuple``
        (
        iterations=iterations, 
        dt=time_step, 
        write_interval=write_interval)
end</code></pre><p>This is a convenience function to set the top-level runtime information. The inputs are all keyword arguments and provide basic information to flow solvers just before running a simulation.</p><p><strong>Input arguments</strong></p><ul><li><code>iterations::Integer</code> specifies the number of iterations in a simulation run.</li><li><code>write_interval::Integer</code> defines how often simulation results are written to file (on the current working directory). The interval is currently based on number of iterations. Set to <code>-1</code> to run without writing results to file.</li><li><code>time_step::Number</code> the time step to use in the simulation. Notice that for steady solvers this is simply a counter and it is recommended to simply use <code>1</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">runtime = set_runtime(
    iterations=2000, time_step=1, write_interval=2000)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mberto79/XCALibre.jl/blob/33357fdd1b3b651e206eee3c9c2396aacdb0a1f7/src/Solve/Solve_1_api.jl#L77-L106">source</a></section></article><h2 id="Configuration-object"><a class="docs-heading-anchor" href="#Configuration-object">Configuration object</a><a id="Configuration-object-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration-object" title="Permalink"></a></h2><hr/><p>Once all the simulation configuration information has been defined, from discretisation scheme to runtime information, all settings must be wrapped in a <code>Configuration</code> object. The definition, including expected input arguments, for the <code>Configuration</code> object are detailed below.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="XCALibre.Simulate.Configuration-user_guide-4_runtime_and_solvers" href="#XCALibre.Simulate.Configuration-user_guide-4_runtime_and_solvers"><code>XCALibre.Simulate.Configuration</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@kwdef struct Configuration{SC,SL,RT,HW}
    schemes::SC
    solvers::SL
    runtime::RT
    hardware::HW
end</code></pre><p>The <code>Configuration</code> type is passed to all flow solvers and provides all the relevant information to run a simulation. </p><p><strong>Inputs</strong></p><ul><li><code>schemes::NamedTuple</code> this keyword argument is used to pass distretisation scheme information to flow solvers. See <a href="../3_numerical_setup/#Numerical-setup">Numerical setup</a> for details.</li><li><code>solvers::NamedTuple</code> this keyword argument is used to pass the configurations for the linear solvers for each field information to flow solvers. See <a href="#Runtime-and-solvers">Runtime and solvers</a> for details.</li><li><code>runtime::NamedTuple</code> this keyword argument is used to pass runtime information to the flow solvers. See <a href="#Runtime-and-solvers">Runtime and solvers</a> for details.</li><li><code>hardware::NamedTuple</code> this keyword argument is used to pass the hardware configuration and backend settings to the flow solvers. See <a href="../1_preprocessing/#Pre-processing">Pre-processing</a> for details.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">config = Configuration(
    solvers=solvers, schemes=schemes, runtime=runtime, hardware=hardware)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mberto79/XCALibre.jl/blob/33357fdd1b3b651e206eee3c9c2396aacdb0a1f7/src/Simulate/Simulate_0_types.jl#L4-L27">source</a></section></article><h2 id="Initialising-fields"><a class="docs-heading-anchor" href="#Initialising-fields">Initialising fields</a><a id="Initialising-fields-1"></a><a class="docs-heading-anchor-permalink" href="#Initialising-fields" title="Permalink"></a></h2><hr/><p>The last (optional) step before running the simulation is to provide an initial guess for all the fields being solved. Although this step is optional, in most cases the flow solvers will perform better when initialised. To set an initial value for a field, the <code>initialise!</code> function is provided, which assigns a starting value to a given field.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="XCALibre.Fields.initialise!-user_guide-4_runtime_and_solvers" href="#XCALibre.Fields.initialise!-user_guide-4_runtime_and_solvers"><code>XCALibre.Fields.initialise!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function initialise!(field, value) # dummy function for documentation
    # Assign `value` to field in-place
    nothing
end</code></pre><p>This function will set the given <code>field</code> to the <code>value</code> provided in-place. Useful for initialising fields prior to running a simulation.</p><p><strong>Input arguments</strong></p><ul><li><code>field</code> specifies the field to be initialised. The field must be either a <code>AbractScalarField</code> or <code>AbstractVectorField</code></li><li><code>value</code> defines the value to be set. This should be a scalar or vector (3 components) depending on the field to be modified e.g. for an <code>AbstractVectorField</code> we can specify as <code>value=[10,0,0]</code></li></ul><p>Note: in most cases the fields to be modified are stored within a physics model i.e. a <code>Physics</code> object. Thus, the argument <code>value</code> must fully qualify the model. For example, if we have created a <code>Physics</code> model named <code>mymodel</code> to set the velocity field, <code>U</code>, we would set the argument <code>field</code> to <code>mymodel.momentum.U</code>. See the example below.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">initialise!(mymodel.momentum.U, [2.5, 0, 0])
initialise!(mymodel.momentum.p, 1.25)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mberto79/XCALibre.jl/blob/33357fdd1b3b651e206eee3c9c2396aacdb0a1f7/src/Fields/Fields_0_types.jl#L239-L260">source</a></section></article><h2 id="Launching-flow-solvers"><a class="docs-heading-anchor" href="#Launching-flow-solvers">Launching flow solvers</a><a id="Launching-flow-solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Launching-flow-solvers" title="Permalink"></a></h2><hr/><p>In XCALibre.jl the <code>run!</code> function is used to start a simulation, which will dispatch to the appropriate flow solver for execution. Once the simulation is complete a <code>NamedTuple</code> containing residual information is returned for users to explore the convergence history of the simulation. </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="XCALibre.Solvers.run!-Tuple{}-user_guide-4_runtime_and_solvers" href="#XCALibre.Solvers.run!-Tuple{}-user_guide-4_runtime_and_solvers"><code>XCALibre.Solvers.run!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function run!(
    model::Physics, config; 
    limit_gradient=false, pref=nothing, ncorrectors=0, inner_loops=0
    )

    # here an internal function is used for solver dispatch
    return residuals
end</code></pre><p>This is the top level API function to initiate a simulation. It uses the user-provided <code>model</code> defined as a <code>Physics</code> object to dispatch to the appropriate solver.</p><p><strong>Dispatched flow solvers</strong></p><ul><li>Steady incompressible (SIMPLE algorithm for coupling)</li><li>Transient incompressible (PISO algorithm for coupling)</li><li>Steady weakly compressible (SIMPLE algorithm for coupling)</li><li>Transient weakly compressible (PISO algorithm for coupling)</li></ul><p><strong>Input arguments</strong></p><ul><li><code>model</code> reference to a <code>Physics</code> model defined by the user.</li><li><code>config</code> Configuration structure defined by the user with solvers, schemes, runtime and hardware structures configuration details.</li><li><code>limit_gradient</code> flag used to activate gradient limiters in the solver (default = <code>false</code>)</li><li><code>pref</code> Reference pressure value for cases that do not have a pressure defining BC. Incompressible solvers only (default = <code>nothing</code>)</li><li><code>ncorrectors</code> number of non-orthogonality correction loops (default = <code>0</code>)</li><li><code>inner_loops</code> number to inner loops used in transient solver based on PISO algorithm (default = <code>0</code>)</li></ul><p><strong>Output</strong></p><p>This function returns a <code>NamedTuple</code> for accessing the residuals (e.g. <code>residuals.Ux</code>). The fields available within the returned <code>residuals</code> tuple depend on the solver used. For example, for an incompressible solver, a x-momentum equation residual can be retrieved accessing the <code>Ux</code> field i.e. <code>residuals.Ux</code>. Look at reference guide for each dispatch method to find out which fields are available.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">residuals = run!(model, config) 

# to access the pressure residual

residuals.p </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mberto79/XCALibre.jl/blob/33357fdd1b3b651e206eee3c9c2396aacdb0a1f7/src/Solvers/Solvers_3_solver_dispatch.jl#L3-L44">source</a></section></article><h2 id="Restarting-simulations"><a class="docs-heading-anchor" href="#Restarting-simulations">Restarting simulations</a><a id="Restarting-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Restarting-simulations" title="Permalink"></a></h2><hr/><p>It should be noted that when running a simulation with <code>run!</code>, the solution fields in the <code>Physics</code> model are mutated. Thus, running the simulation from the previous solution is simply a matter of reissuing the <code>run!</code> function. At present, this has the side effect of overwriting any existing solution files (<code>.vtk</code> or <code>.vtu</code>). Users must be aware of this behaviour.</p><p>In some cases, it may be desirable to solve a problem with a steady solver and use the solution to run transient simulations. This is possible using the <code>change</code> function.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="XCALibre.ModelPhysics.change-user_guide-4_runtime_and_solvers" href="#XCALibre.ModelPhysics.change-user_guide-4_runtime_and_solvers"><code>XCALibre.ModelPhysics.change</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">change(model::Physics, property, value) =&gt; updatedModel::Physics</code></pre><p>A convenience function to change properties of an exisitng <code>Physics</code> model.</p><p><strong>Input arguments</strong></p><ul><li><code>model::Physics</code> a <code>Physics</code> model to modify</li><li><code>property</code> is a symbol specifying the property to change </li><li><code>value</code> is the new setting for the specified <code>property</code></li></ul><p><strong>Output</strong></p><p>This function return a new <code>Physics</code> object</p><p><strong>Example</strong></p><p>To change a model to run a transient simulation e.g. after converging in steady state</p><pre><code class="nohighlight hljs">modelTransient = change(model, :time, Transient())</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mberto79/XCALibre.jl/blob/33357fdd1b3b651e206eee3c9c2396aacdb0a1f7/src/ModelPhysics/3_physics_API.jl#L3-L22">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_numerical_setup/">« Numerical setup</a><a class="docs-footer-nextpage" href="../5_postprocessing/">Post-processing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 14 October 2024 16:19">Monday 14 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
